generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")

}

enum TransactionType {
  BUY
  BORROW
  RETURN
}

enum UserRole {
  ADMIN
  MANAGER
  STAFF
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  role      UserRole @default(STAFF)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ProductCategory {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  products  Product[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Supplier {
  id        Int      @id @default(autoincrement())
  name      String
  phone     String?
  email     String?
  products  Product[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Customer {
  id        Int      @id @default(autoincrement())
  name      String
  phone     String?
  email     String?
  address   String?
  transactions Transaction[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Product {
  id            Int     @id @default(autoincrement())
  categoryId    Int
  supplierId    Int?
  name          String
  type          String? // enum-like but flexible; could make an enum if fixed
  costPrice     Decimal @db.Decimal(12,2)
  sellingPrice  Decimal @db.Decimal(12,2)

  category ProductCategory @relation(fields: [categoryId], references: [id])
  supplier Supplier?        @relation(fields: [supplierId], references: [id])
  stock    Stock?
  items    TransactionItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Stock {
  id                Int    @id @default(autoincrement())
  productId         Int    @unique
  totalQuantity     Int
  availableQuantity Int
  itemCount         Int?   // for countable items
  product           Product @relation(fields:[productId], references:[id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Transaction {
  id           Int              @id @default(autoincrement())
  customerId   Int?
  type         TransactionType
  date         DateTime         @default(now())
  totalAmount  Decimal @db.Decimal(12,2)
  totalCost    Decimal @db.Decimal(12,2)
  profitLoss   Decimal @db.Decimal(12,2)

  customer  Customer?         @relation(fields:[customerId], references:[id])
  items     TransactionItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TransactionItem {
  id             Int     @id @default(autoincrement())
  transactionId  Int
  productId      Int
  quantity       Int
  costPrice      Decimal @db.Decimal(12,2)
  sellingPrice   Decimal @db.Decimal(12,2)
  subtotalCost   Decimal @db.Decimal(12,2)
  subtotalRevenue Decimal @db.Decimal(12,2)
  profitLoss     Decimal @db.Decimal(12,2)

  transaction Transaction @relation(fields:[transactionId], references:[id])
  product     Product     @relation(fields:[productId], references:[id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
